<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EBC Live Verification Engine</title>
<style>

body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#0a0f1f,#111a33);
color:white;
text-align:center;
overflow:auto;
}

.card{
width:95%;
max-width:420px;
margin:20px auto;
padding:20px;
background:rgba(255,255,255,0.05);
border-radius:20px;
backdrop-filter:blur(10px);
box-shadow:0 0 20px rgba(0,255,255,0.2);
}

h2{
margin-top:5px;
color:#00eaff;
}

button{
padding:12px 25px;
border:none;
border-radius:10px;
background:#00eaff;
color:black;
font-weight:bold;
cursor:pointer;
margin-top:10px;
}

canvas{
margin-top:15px;
background:#0c1326;
border-radius:12px;
}

#statusBox{
margin-top:15px;
font-size:16px;
}

.layer{
margin-top:6px;
font-size:14px;
}

.success{
color:#00ff9d;
font-weight:bold;
}

.fail{
color:#ff4c6a;
font-weight:bold;
}

.progress{
height:6px;
background:#222;
margin-top:10px;
border-radius:4px;
overflow:hidden;
}

.progressBar{
height:100%;
width:0%;
background:#00eaff;
transition:width 0.2s;
}

</style>
</head>
<body>

<div class="card">

<h2>EBC â€“ Live Human Verification</h2>

<button onclick="startVerification()">Run Verification</button>

<div class="progress">
<div id="progressBar" class="progressBar"></div>
</div>

<canvas id="drawArea" width="320" height="200"></canvas>

<div id="statusBox"></div>

</div>

<script>

let collecting=false;
let touchActive=false;
let tremorSamples=[];
let xyzData=[];
let tremorScore=0;
let challengeType=0;
let points=[];
let duration=5000;

// ---------- START ----------
function startVerification(){
tremorSamples=[];
xyzData=[];
points=[];
collecting=true;
document.getElementById("statusBox").innerHTML="Draw the challenge pattern";
startChallenge();
animateProgress();

setTimeout(()=>{
collecting=false;
processTremor();
evaluateChallenge();
},duration);
}

// ---------- PROGRESS ----------
function animateProgress(){
let start=Date.now();
let interval=setInterval(()=>{
let elapsed=Date.now()-start;
let percent=(elapsed/duration)*100;
document.getElementById("progressBar").style.width=percent+"%";
if(percent>=100) clearInterval(interval);
},100);
}

// ---------- MOTION ----------
window.addEventListener("devicemotion",function(e){
if(!collecting || !touchActive || !e.acceleration) return;

let x=e.acceleration.x||0;
let y=e.acceleration.y||0;
let z=e.acceleration.z||0;

let mag=Math.sqrt(x*x+y*y+z*z);
tremorSamples.push(mag);
xyzData.push({x,y,z});
});

// ---------- TREMOR ----------
function processTremor(){
if(tremorSamples.length<20){ tremorScore=0; return; }

let mean=tremorSamples.reduce((a,b)=>a+b,0)/tremorSamples.length;
let variance=tremorSamples.reduce((a,b)=>a+(b-mean)*(b-mean),0)/tremorSamples.length;
let std=Math.sqrt(variance);

if(std<0.01){ tremorScore=0; return; }

tremorScore=Math.min(100,std*2000);
}

// ---------- CHALLENGE ----------
let canvas=document.getElementById("drawArea");
let ctx=canvas.getContext("2d");

function startChallenge(){
ctx.clearRect(0,0,320,200);
challengeType=Math.floor(Math.random()*6);
ctx.strokeStyle="#00eaff";
ctx.lineWidth=3;
ctx.beginPath();

switch(challengeType){
case 0: ctx.moveTo(20,100); ctx.lineTo(300,100); break;
case 1: ctx.moveTo(160,20); ctx.lineTo(160,180); break;
case 2: ctx.moveTo(50,150); ctx.lineTo(160,50); ctx.lineTo(270,150); break;
case 3: ctx.moveTo(20,150); ctx.lineTo(100,50); ctx.lineTo(180,150); ctx.lineTo(260,50); break;
case 4: ctx.arc(160,100,60,0,2*Math.PI); break;
case 5: ctx.moveTo(50,50); ctx.lineTo(50,150); ctx.lineTo(200,150); break;
}
ctx.stroke();
}

canvas.addEventListener("touchstart",()=>{touchActive=true;});
canvas.addEventListener("touchend",()=>{touchActive=false;});

canvas.addEventListener("touchmove",function(e){
e.preventDefault();
let rect=canvas.getBoundingClientRect();
let x=e.touches[0].clientX-rect.left;
let y=e.touches[0].clientY-rect.top;
points.push({x,y});
ctx.fillStyle="white";
ctx.fillRect(x,y,3,3);
});

// ---------- EVALUATION ----------
function evaluateChallenge(){
let accuracy=(points.length>10)?100:0;

if(tremorScore===0){
document.getElementById("statusBox").innerHTML=
"<div class='fail'>Verification Failed</div>"+
"<div class='layer'>Tremor Layer: 0%</div>"+
"<div class='layer'>Challenge Layer: "+accuracy+"%</div>";
return;
}

document.getElementById("statusBox").innerHTML=
"<div class='success'>Human Verified</div>"+
"<div class='layer'>Tremor Layer: "+tremorScore.toFixed(0)+"%</div>"+
"<div class='layer'>Challenge Layer: "+accuracy+"%</div>";

}

</script>
</body>
</html>
